<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ | 3CX Quick Call</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg:#0b1220; --txt:#f8fafc; --muted:#a3aed0; --brand:#2563eb; --glass:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.12); --shadow: 0 10px 30px rgba(0,0,0,.4); --radius: 18px;
    }
    *{ box-sizing:border-box }
    body{
      margin:0; color:var(--txt);
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Tajawal", "Noto Kufi Arabic", Arial, sans-serif;
      min-height:100svh;
      /* Ø®Ù„ÙÙŠØ© Ù…Ø²Ø®Ø±ÙØ© */
      background:
        radial-gradient(1200px 600px at 110% -20%, rgba(37,99,235,.25), transparent),
        radial-gradient(1000px 500px at -10% -10%, rgba(16,185,129,.14), transparent),
        linear-gradient(180deg, #0b1220 0%, #0e1528 100%);
    }
    .wrap{ max-width:880px; margin:6rem auto; padding:0 1.2rem; }
    .hero{
      position:relative; overflow:hidden;
      border:1px solid var(--border);
      background: color-mix(in oklab, var(--glass) 100%, transparent);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: clamp(1.2rem, 3vw, 2rem);
    }
    .hero::after{
      content:""; position:absolute; inset:auto -10% -40% -10%;
      height:160px; background: radial-gradient(600px 120px at 50% 0%, rgba(37,99,235,.25), transparent);
      filter: blur(30px);
    }
    h1{ margin:.2rem 0 0; font-size: clamp(1.4rem, 3.1vw, 2.2rem) }
    p{ margin:.7rem 0 0; color:var(--muted) }
    .cta{ margin-top:1.2rem; display:flex; gap:.8rem; flex-wrap:wrap; align-items:center }
    .btn{
      appearance:none; cursor:pointer; border:1px solid color-mix(in oklab, var(--brand), #000 35%);
      background: linear-gradient(180deg, color-mix(in oklab, var(--brand), #fff 10%), var(--brand));
      color:#fff; font-weight:700; padding:.9rem 1.2rem; border-radius:14px; box-shadow:0 10px 24px rgba(37,99,235,.25);
      transition: transform .08s ease, filter .2s ease;
    }
    .btn:hover{ filter:brightness(1.05) } .btn:active{ transform: translateY(1px) }
    .note{ color:var(--muted); font-size:.95rem }

    /* Ø²Ø± 3CX Ø§Ù„Ø¹Ø§Ø¦Ù… Ø¨Ø¥ÙŠÙ‚ÙˆÙ†Ø© SVG Ù…Ø¯Ù…Ø¬Ø© */
    .fab{
      position: fixed; inset-block-end: 24px; inset-inline-end: 24px; z-index: 50;
      width:62px; height:62px; border-radius:50%;
      display:grid; place-items:center; cursor:pointer;
      background:#0b1a2e; border:1px solid #1f2b40; box-shadow: var(--shadow);
    }
    .fab svg{ width:64%; height:64%; }
    .fab:active{ transform: translateY(1px) }

    /* Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .modal{
      position:fixed; inset:0; display:none; place-items:center; padding:1rem;
      background: rgba(0,0,0,.5);
    }
    .modal[open]{ display:grid; animation:fade .12s ease }
    @keyframes fade{ from{ opacity:0 } to{ opacity:1 } }
    .sheet{
      width:min(520px, 100%); background: rgba(17,24,39,.9); color:var(--txt);
      border-radius:16px; padding:1.25rem 1.25rem 1rem; box-shadow: var(--shadow);
      border:1px solid var(--border);
    }
    .sheet h3{ margin:.2rem 0 .6rem; font-size:1.15rem }
    label{ display:block; margin:.4rem 0; color:var(--muted) }
    input[type="tel"]{
      width:100%; padding:1rem; border-radius:12px; background:#0f1627; color:inherit;
      border:1px solid color-mix(in oklab, #ffffff, #000 85%);
      outline:none;
    }
    .row{ display:flex; gap:.7rem; margin-top:.9rem; flex-wrap:wrap }
    .btn.secondary{ background:transparent; color:#e2e8f0; border-color: color-mix(in oklab, #ffffff, #000 80%); box-shadow:none }
    .status{ margin-top:.6rem; font-size:.95rem; min-height:1.2em; color:var(--muted) }
    .status.ok{ color:#22c55e } .status.err{ color:#ef4444 }
  </style>
</head>
<body>

  <div class="wrap">
    <section class="hero" aria-label="Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡">
      <h6 style="margin:0;color:var(--muted);font-weight:700">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h6>
      <h1>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨ÙƒÙ… ÙÙŠ ØµÙØ­Ø© Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h1>
      <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§ØªØµØ§Ù„ ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± Ø³Ù†ØªØ±Ø§Ù„ <b>3CX</b>. Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ø£Ùˆ Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù…ØŒ ÙˆØ£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙˆØ¬Ù‡Ø© (Ù…Ø«Ù„ <b>201</b>) Ù„ÙŠÙ‚ÙˆÙ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ù† ØªØ­ÙˆÙŠÙ„Ø© <b>327</b> Ø¥Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨.</p>
      <div class="cta">
        <button class="btn" id="open-modal" aria-haspopup="dialog">Ø¨Ø¯Ø¡ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù†</button>
        <span class="note">ÙŠØ¯Ø¹Ù… Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© ÙˆØ§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© (+E.164).</span>
      </div>
      <!-- ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ -->
    </section>
  </div>

  <!-- Ø²Ø± 3CX Ø§Ù„Ø¹Ø§Ø¦Ù… (SVG Ù…Ø¶Ù…Ù‘Ù†) -->
  <button class="fab" id="fab" title="Ø§ØªØµÙ„ Ø¹Ø¨Ø± 3CX" aria-label="Ø§ØªØµÙ„ Ø¹Ø¨Ø± 3CX">
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
      <rect x="0" y="0" width="64" height="64" rx="16" fill="#0b1a2e"/>
      <text x="50%" y="56%" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="28" fill="#ffffff" font-weight="700">3CX</text>
    </svg>
  </button>

  <!-- Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
  <dialog class="modal" id="modal" aria-modal="true" aria-labelledby="modal-title">
    <div class="sheet">
      <h3 id="modal-title">Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ø¨Ø± 3CX</h3>
      <label for="to">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‡</label>
      <input id="to" inputmode="tel" type="tel" placeholder="Ù…Ø«Ø§Ù„: 201 Ø£Ùˆ +9715XXXXXXX" autocomplete="off" />
      <div class="row">
        <button class="btn" id="call-btn">Ø§ØªØµØ§Ù„</button>
        <button class="btn secondary" id="close-modal">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <div class="status" id="status"></div>
    </div>
  </dialog>

  <script>
    // Ø¹Ù†Ø§ØµØ±
    const modal = document.getElementById('modal');
    const openModal = document.getElementById('open-modal');
    const closeModal = document.getElementById('close-modal');
    const fab = document.getElementById('fab');
    const input = document.getElementById('to');
    const callBtn = document.getElementById('call-btn');
    const statusEl = document.getElementById('status');

    // ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚
    const open = () => { modal.setAttribute('open',''); input.value=''; input.focus(); document.addEventListener('keydown', escClose, { once:true }); };
    const close = () => { modal.removeAttribute('open'); };
    const escClose = (e) => { if(e.key==='Escape') close(); };
    openModal.addEventListener('click', open);
    fab.addEventListener('click', open);
    closeModal.addEventListener('click', close);
    modal.addEventListener('click', e => { if(e.target===modal) close(); });

    // Ø§ØªØµØ§Ù„
    async function queueCall(to){
      const ALLOWED = /^[0-9+*#]{2,32}$/;
      if(!ALLOWED.test((to||'').trim())){
        statusEl.textContent = 'Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± ØµØ§Ù„Ø­.';
        statusEl.className = 'status err';
        return { ok:false };
      }
      try{
        const res = await fetch('/.netlify/functions/enqueue', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ to })
        });
        const txt = await res.text();
        let data; try{ data = JSON.parse(txt); } catch { data = { raw: txt || null }; }
        // Ù„Ø§ Ù†Ø·Ø¨Ø¹ Ø£ÙŠ JSON Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª â€” ÙÙ‚Ø· Ø­Ø§Ù„Ø© Ù…Ø®ØªØµØ±Ø©:
        if(res.ok){
          statusEl.textContent = 'âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ 3CX.';
          statusEl.className = 'status ok';
        }else{
          statusEl.textContent = 'âœ– Ù„Ù… ÙŠÙ†Ø¬Ø­ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ØªØ­Ù‚Ù‘Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª/Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.';
          statusEl.className = 'status err';
        }
        // Ù„ØªØªØ¨Ù‘Ø¹ Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø·:
        console.debug('enqueue result:', data);
        return { ok: res.ok, data };
      }catch(err){
        statusEl.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….';
        statusEl.className = 'status err';
        console.error(err);
        return { ok:false };
      }
    }

    callBtn.addEventListener('click', async () => {
      const to = input.value.trim();
      callBtn.disabled = true;
      callBtn.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„â€¦';
      statusEl.textContent = '';
      const result = await queueCall(to);
      callBtn.disabled = false;
      callBtn.textContent = 'Ø§ØªØµØ§Ù„';
      if(result.ok){ setTimeout(close, 1200); }
    });
  </script>
  <script>
  // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© AI
  const aiModal = document.getElementById('ai-modal');
  const aiFab = document.getElementById('ai-fab');
  const aiSend = document.getElementById('ai-send');
  const aiInput = document.getElementById('ai-input');
  const chatBox = document.getElementById('chat-box');

  // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
  aiFab.onclick = () => {
    aiModal.setAttribute('open','');
    aiInput.focus();
  };

  // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ
  function speak(text){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ar-SA"; // Ø§Ù„Ù„ØºØ©: Ø¹Ø±Ø¨ÙŠ
    u.rate = 1;
    speechSynthesis.speak(u);
  }

  // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„
  aiSend.onclick = async () => {
    const msg = aiInput.value.trim();
    if(!msg) return;

    // Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    chatBox.innerHTML += `<div style="color:#38bdf8;margin:.3rem 0">ğŸ‘¤: ${msg}</div>`;
    aiInput.value = '';

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Netlify (chat.js)
    const res = await fetch('/.netlify/functions/chat', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({ message: msg })
    });

    const data = await res.json();
    const reply = data.reply || "Ù„Ù… Ø£ÙÙ‡Ù…ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";

    // Ø£Ø¶Ù Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª
    chatBox.innerHTML += `<div style="color:#22c55e;margin:.3rem 0">ğŸ¤–: ${reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;

    // Ù†Ø·Ù‚ Ø§Ù„Ø±Ø¯
    speak(reply);
  };
</script>

  <button class="fab" id="ai-fab" title="Ù…Ø³Ø§Ø¹Ø¯ AI" aria-label="Ù…Ø³Ø§Ø¹Ø¯ AI">ğŸ¤–</button>

<!-- Ù†Ø§ÙØ°Ø© AI -->
<dialog class="modal" id="ai-modal">
  <div class="sheet">
    <h3>Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯</h3>
    <div id="chat-box" style="max-height:300px;overflow:auto;background:#111;padding:.8rem;border-radius:12px;font-size:.95rem"></div>
    <div class="row">
      <input id="ai-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." style="flex:1;padding:.8rem;border-radius:12px" />
      <button class="btn" id="ai-send">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>
</dialog>
</body>
</html>
